<!doctype html>
<html>
  <head>
    <title>API Test</title>
  </head>
  <body>
    <h1>Testing Frontend-Backend Connection</h1>
    <div id="results"></div>

    <script>
      const results = document.getElementById('results');

      function log(message) {
        console.log(message);
        results.innerHTML += '<p>' + message + '</p>';
      }

      async function testLogin() {
        try {
          log('üîÑ Testing Login...');

          const response = await fetch('http://localhost:3000/api/v1/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: 'test@example.com',
              password: 'test123'
            })
          });

          const data = await response.json();

          if (response.ok) {
            log('‚úÖ Login Success: ' + JSON.stringify(data));
          } else {
            log('‚ùå Login Failed: ' + response.status + ' - ' + response.statusText);
            log('Error details: ' + JSON.stringify(data));
          }
        } catch (error) {
          log('‚ùå Login Network Error: ' + error.message);
        }
      }

      async function testRegister() {
        try {
          log('üîÑ Testing Register...');

          const randomEmail = 'test' + Date.now() + '@example.com';

          const response = await fetch('http://localhost:3000/api/v1/public/user_registration', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              user: {
                email: randomEmail,
                password: 'test123',
                password_confirmation: 'test123',
                oab: '12345'
              }
            })
          });

          const data = await response.json();

          if (response.ok) {
            log('‚úÖ Register Success: ' + JSON.stringify(data));
          } else {
            log('‚ùå Register Failed: ' + response.status + ' - ' + response.statusText);
            log('Error details: ' + JSON.stringify(data));
          }
        } catch (error) {
          log('‚ùå Register Network Error: ' + error.message);
        }
      }

      // Run tests automatically
      async function runTests() {
        await testRegister();
        await testLogin();
      }

      runTests();
    </script>
  </body>
</html>
