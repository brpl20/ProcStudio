// Law Firm Management System Database Diagram

// --- Metadados e Arquivos (Active Storage) ---
Table active_storage_attachments {
  id bigint [pk, increment]
  name varchar [not null]
  record_type varchar [not null]
  record_id bigint [not null]
  blob_id bigint [not null, ref: > active_storage_blobs.id]
  created_at datetime [not null]

  indexes {
    (record_type, record_id, name, blob_id) [unique, name: "index_active_storage_attachments_uniqueness"]
    blob_id
  }
}

Table active_storage_blobs {
  id bigint [pk, increment]
  key varchar [not null, unique]
  filename varchar [not null]
  content_type varchar
  metadata text
  service_name varchar [not null]
  byte_size bigint [not null]
  checksum varchar
  created_at datetime [not null]
}

Table active_storage_variant_records {
  id bigint [pk, increment]
  blob_id bigint [not null, ref: > active_storage_blobs.id]
  variation_digest varchar [not null]

  indexes {
    (blob_id, variation_digest) [unique, name: "index_active_storage_variant_records_uniqueness"]
  }
}

// --- Entidades Principais ---
Table individual_entities {
  id bigint [pk, increment]
  name varchar [not null]
  last_name varchar
  gender varchar
  rg varchar
  cpf varchar [not null, unique]
  nationality varchar
  civil_status varchar
  profession varchar
  birth_date date
  mother_name varchar
  nit varchar
  inss_password varchar
  invalid_person boolean [default: false]
  additional_documents json [default: '{}']
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (name, last_name)
    deleted_at
  }
}

Table legal_entities {
  id bigint [pk, increment]
  name varchar [not null]
  cnpj varchar
  inscription_number varchar
  state_registration varchar
  oab_id varchar
  society_link varchar
  number_of_partners integer
  status varchar [default: "active"]
  accounting_type varchar
  entity_type varchar
  legal_representative_id bigint [ref: > individual_entities.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    cnpj [unique, note: "where cnpj is not null"]
    entity_type
    status
    deleted_at
  }
}

// --- Usuários e Perfis ---
Table admins {
  id bigint [pk, increment]
  email varchar [not null, default: "", unique]
  encrypted_password varchar [not null, default: ""]
  reset_password_token varchar [unique]
  reset_password_sent_at datetime
  remember_created_at datetime
  jwt_token varchar [unique]
  deleted_at datetime
  status varchar [not null, default: "active"]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    deleted_at
  }
}

Table profile_admins {
  id bigint [pk, increment]
  role varchar
  name varchar
  last_name varchar
  gender varchar
  oab varchar
  rg varchar
  cpf varchar
  nationality varchar
  civil_status varchar
  birth_date date
  mother_name varchar
  status varchar
  admin_id bigint [not null, ref: > admins.id]
  office_id bigint [ref: > offices.id]
  origin varchar
  deleted_at datetime
  individual_entity_id bigint [ref: > individual_entities.id]
  legal_entity_id bigint [ref: > legal_entities.id]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    admin_id
    office_id
    deleted_at
  }
}

Table customers {
  id bigint [pk, increment]
  email varchar [not null, default: ""]
  encrypted_password varchar [not null, default: ""]
  reset_password_token varchar [unique]
  reset_password_sent_at datetime
  remember_created_at datetime
  deleted_at datetime
  jwt_token varchar
  created_by_id bigint [ref: > admins.id]
  confirmation_token varchar [unique]
  confirmed_at datetime
  confirmation_sent_at datetime
  unconfirmed_email varchar // Corrected from datetime
  status varchar [not null, default: "active"]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    email [unique, note: "where deleted_at is null"]
    deleted_at
    created_by_id
  }
}

Table profile_customers {
  id bigint [pk, increment]
  customer_type varchar
  name varchar
  last_name varchar
  gender varchar
  rg varchar
  cpf varchar
  cnpj varchar
  nationality varchar
  civil_status varchar
  capacity varchar
  profession varchar
  company varchar
  birth_date date
  mother_name varchar
  benefit_number varchar // Renamed from number_benefit
  document json
  nit varchar
  inss_password varchar
  invalid_person boolean // Corrected from integer
  customer_id bigint [not null, ref: > customers.id]
  accountant_id bigint [ref: > profile_admins.id, note: "FK to a profile_admin with accountant role"]
  deleted_at datetime
  created_by_id bigint [ref: > admins.id]
  status varchar [not null, default: "active"]
  individual_entity_id bigint [ref: > individual_entities.id]
  legal_entity_id bigint [ref: > legal_entities.id]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    customer_id
    accountant_id
    deleted_at
    created_by_id
  }
}

// --- Equipes e Assinaturas ---
Table teams {
  id bigint [pk, increment]
  name varchar [not null]
  subdomain varchar [not null, unique]
  main_admin_id bigint [not null, ref: > admins.id]
  owner_admin_id bigint [not null, ref: > admins.id]
  status varchar [default: "active"]
  settings json [default: '{}']
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    main_admin_id
    owner_admin_id
    status
    deleted_at
  }
}

Table team_memberships {
  id bigint [pk, increment]
  team_id bigint [not null, ref: > teams.id]
  admin_id bigint [not null, ref: > admins.id]
  role varchar [not null, default: "member"]
  status varchar [default: "active"]
  joined_at datetime
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (team_id, admin_id) [unique]
    team_id
    admin_id
    role
    status
    deleted_at
  }
}

// --- Escritórios ---
Table offices {
  id bigint [pk, increment]
  name varchar
  cnpj varchar
  oab varchar
  society varchar
  foundation_date date
  site varchar
  cep varchar
  street varchar
  number integer
  neighborhood varchar
  city varchar
  state varchar
  office_type_id bigint [not null, ref: > office_types.id]
  responsible_lawyer_id bigint [ref: > profile_admins.id]
  accounting_type varchar
  deleted_at datetime
  team_id bigint [ref: > teams.id]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    office_type_id
    responsible_lawyer_id
    accounting_type
    deleted_at
    team_id
  }
}

Table office_types {
  id bigint [pk, increment]
  description varchar
  created_at datetime [not null]
  updated_at datetime [not null]
}

Table team_offices {
  id bigint [pk, increment]
  team_id bigint [not null, ref: > teams.id]
  office_id bigint [not null, ref: > offices.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (team_id, office_id) [unique]
    team_id
    office_id
    deleted_at
  }
}

// --- Assinaturas e Pagamentos ---
Table subscription_plans {
  id bigint [pk, increment]
  name varchar [not null]
  description text
  price decimal(10,2)
  currency varchar [default: "BRL"]
  billing_interval varchar
  max_users integer
  max_offices integer
  max_cases integer
  features json [default: '{}']
  is_active boolean [default: true]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    billing_interval
    is_active
  }
}

Table subscriptions {
  id bigint [pk, increment]
  team_id bigint [not null, ref: > teams.id]
  subscription_plan_id bigint [not null, ref: > subscription_plans.id]
  start_date date [not null]
  end_date date
  status varchar [default: "trial"]
  trial_end_date date
  monthly_amount decimal(10,2)
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    team_id
    subscription_plan_id
    (team_id, status)
    status
    deleted_at
  }
}

Table payment_transactions {
  id bigint [pk, increment]
  subscription_id bigint [not null, ref: > subscriptions.id]
  amount decimal(10,2) [not null]
  currency varchar [default: "BRL"]
  status varchar [default: "pending"]
  payment_method varchar
  transaction_id varchar
  payment_data json [default: '{}']
  processed_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    subscription_id
    transaction_id
    status
    processed_at
  }
}

// --- Processos e Atividades (Works) ---
Table works {
  id bigint [pk, increment]
  procedure_number varchar // Renamed from procedure
  subject varchar
  rate_parceled_exfield varchar [note: "Renomear para algo mais claro, ex: 'fee_installment_details'"]
  folder varchar
  note varchar
  extra_pending_document varchar
  civel_area varchar
  social_security_area varchar
  labor_area varchar // Corrected from laborite_areas
  tributary_area varchar
  other_description text
  compensations_five_years boolean
  compensations_service boolean
  lawsuit boolean
  gain_projection varchar
  responsible_lawyer_id bigint [ref: > profile_admins.id]
  partner_lawyer_id bigint [ref: > profile_admins.id]
  intern_id bigint [ref: > profile_admins.id]
  bachelor_id bigint [ref: > profile_admins.id]
  initial_attendee_id bigint [ref: > profile_admins.id]
  procedures text[] [default: "{}"]
  created_by_id bigint [ref: > admins.id]
  status varchar [default: "in_progress"]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    created_by_id
    deleted_at
  }
}

Table honoraries {
  id bigint [pk, increment]
  fixed_honorary_value varchar
  parcelling_value varchar
  honorary_type varchar
  percent_honorary_value varchar
  parcelling boolean
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  work_prev integer // Consider removing or clarifying this column
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    work_id
    deleted_at
  }
}

Table documents {
  id bigint [pk, increment]
  document_type varchar
  work_id bigint [not null, ref: > works.id]
  profile_customer_id bigint [ref: > profile_customers.id]
  deleted_at datetime
  format integer [not null, default: 0]
  status integer [not null, default: 0]
  sign_source integer [not null, default: 0]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    work_id
    profile_customer_id
    deleted_at
  }
}

Table pending_documents {
  id bigint [pk, increment]
  description varchar
  work_id bigint [not null, ref: > works.id]
  profile_customer_id bigint [ref: > profile_customers.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    work_id
    profile_customer_id
    deleted_at
  }
}

Table draft_works {
  id bigint [pk, increment]
  name varchar
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    work_id
    deleted_at
  }
}

Table work_events {
  id bigint [pk, increment]
  description varchar
  date datetime
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    work_id
    deleted_at
  }
}

Table powers {
  id bigint [pk, increment]
  description varchar [not null]
  category integer [not null]
  created_at datetime [not null]
  updated_at datetime [not null]
}

Table jobs {
  id bigint [pk, increment]
  description varchar
  deadline date [not null]
  status varchar
  priority varchar
  comment varchar
  profile_admin_id bigint [ref: > profile_admins.id]
  work_id bigint [ref: > works.id]
  profile_customer_id bigint [ref: > profile_customers.id]
  created_by_id bigint [ref: > admins.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    profile_admin_id
    work_id
    profile_customer_id
    created_by_id
    deleted_at
  }
}

// --- Tabelas de Relacionamento (Muitos-para-Muitos) ---
Table customer_works {
  id bigint [pk, increment]
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (profile_customer_id, work_id) [unique]
    deleted_at
  }
}

Table profile_admin_works {
  id bigint [pk, increment]
  profile_admin_id bigint [not null, ref: > profile_admins.id]
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (profile_admin_id, work_id) [unique]
    deleted_at
  }
}

Table office_works {
  id bigint [pk, increment]
  work_id bigint [not null, ref: > works.id]
  office_id bigint [not null, ref: > offices.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (work_id, office_id) [unique]
    deleted_at
  }
}

Table power_works {
  id bigint [pk, increment]
  power_id bigint [not null, ref: > powers.id]
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (power_id, work_id) [unique]
    deleted_at
  }
}

Table recommendations {
  id bigint [pk, increment]
  percentage decimal
  commission decimal
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  work_id bigint [not null, ref: > works.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    profile_customer_id
    work_id
    deleted_at
  }
}

Table represents {
  id bigint [pk, increment]
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  representor_id bigint [ref: > profile_customers.id]
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    profile_customer_id
    representor_id
  }
}

// --- Contatos (Polimórfico - Alternativa a tabelas de junção) ---
// Nota: Esta tabela parece não estar sendo usada, já que existem tabelas de junção específicas (ex: customer_addresses).
// Considere unificar a lógica de contatos aqui ou remover esta tabela se ela não for utilizada.
Table contact_infos {
  id bigint [pk, increment]
  contactable_type varchar [not null]
  contactable_id bigint [not null]
  contact_type varchar [not null] // 'email', 'phone', 'address', 'bank_account'
  contact_data json [not null, default: '{}']
  is_primary boolean [default: false]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (contact_type, contactable_type, contactable_id)
    (contactable_type, contactable_id, is_primary)
    (contactable_type, contactable_id)
    deleted_at
  }
}

// --- Informações de Contato (Tabelas de Junção) ---
Table addresses {
  id bigint [pk, increment]
  description varchar
  zip_code varchar
  street varchar
  number integer
  neighborhood varchar
  city varchar
  state varchar
  created_at datetime [not null]
  updated_at datetime [not null]
}

Table phones {
  id bigint [pk, increment]
  phone_number varchar
  created_at datetime [not null]
  updated_at datetime [not null]
}

Table emails {
  id bigint [pk, increment]
  email varchar
  created_at datetime [not null]
  updated_at datetime [not null]
}

Table bank_accounts {
  id bigint [pk, increment]
  bank_name varchar
  type_account varchar
  agency varchar
  account varchar
  operation varchar
  pix varchar
  created_at datetime [not null]
  updated_at datetime [not null]
}

Table admin_addresses {
  id bigint [pk, increment]
  address_id bigint [not null, ref: > addresses.id]
  profile_admin_id bigint [not null, ref: > profile_admins.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (address_id, profile_admin_id) [unique]
    deleted_at
  }
}

Table admin_phones {
  id bigint [pk, increment]
  phone_id bigint [not null, ref: > phones.id]
  profile_admin_id bigint [not null, ref: > profile_admins.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (phone_id, profile_admin_id) [unique]
    deleted_at
  }
}

Table admin_emails {
  id bigint [pk, increment]
  email_id bigint [not null, ref: > emails.id]
  profile_admin_id bigint [not null, ref: > profile_admins.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (email_id, profile_admin_id) [unique]
    deleted_at
  }
}

Table admin_bank_accounts {
  id bigint [pk, increment]
  bank_account_id bigint [not null, ref: > bank_accounts.id]
  profile_admin_id bigint [not null, ref: > profile_admins.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (bank_account_id, profile_admin_id) [unique]
    deleted_at
  }
}

Table customer_addresses {
  id bigint [pk, increment]
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  address_id bigint [not null, ref: > addresses.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (profile_customer_id, address_id) [unique]
    deleted_at
  }
}

Table customer_phones {
  id bigint [pk, increment]
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  phone_id bigint [not null, ref: > phones.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (profile_customer_id, phone_id) [unique]
    deleted_at
  }
}

Table customer_emails {
  id bigint [pk, increment]
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  email_id bigint [not null, ref: > emails.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (profile_customer_id, email_id) [unique]
    deleted_at
  }
}

Table customer_bank_accounts {
  id bigint [pk, increment]
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  bank_account_id bigint [not null, ref: > bank_accounts.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (profile_customer_id, bank_account_id) [unique]
    deleted_at
  }
}

Table customer_files {
  id bigint [pk, increment]
  file_description varchar
  profile_customer_id bigint [not null, ref: > profile_customers.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    profile_customer_id
    deleted_at
  }
}

Table office_emails {
  id bigint [pk, increment]
  office_id bigint [not null, ref: > offices.id]
  email_id bigint [not null, ref: > emails.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (office_id, email_id) [unique]
    deleted_at
  }
}

Table office_phones {
  id bigint [pk, increment]
  office_id bigint [not null, ref: > offices.id]
  phone_id bigint [not null, ref: > phones.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (office_id, phone_id) [unique]
    deleted_at
  }
}

Table office_bank_accounts {
  id bigint [pk, increment]
  bank_account_id bigint [not null, ref: > bank_accounts.id]
  office_id bigint [not null, ref: > offices.id]
  deleted_at datetime
  created_at datetime [not null]
  updated_at datetime [not null]

  indexes {
    (bank_account_id, office_id) [unique]
    deleted_at
  }
}

Ref: "individual_entities"."invalid_person" < "individual_entities"."profession"
